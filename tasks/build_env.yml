---
- name: add toolchain repository for recent compiler versions
  become: true
  become_user: "{{ root_user }}"
  apt_repository:
    repo: ppa:ubuntu-toolchain-r/test
    state: present
  when: ansible_distribution == 'Ubuntu' and ansible_distribution_version == '16.04'

- name: Install packages for build environment (apt)
  become: true
  become_user: "{{ root_user }}"
  apt:
    name:
      # Compilation
      - build-essential
      - python3-passlib
      - gfortran
      - openmpi-common
      - openmpi-bin
      - libopenmpi-dev
      - libfftw3-dev
      - libfftw3-bin
      - libfftw3-mpi-dev
      - liblapack-dev
      - libblas-dev
      - m4
      - singularity
    update_cache: true

- name: Install python-passlib (apt)
  become: true
  become_user: "{{ root_user }}"
  apt:
    name:
      # Compilation
      - python3-passlib
  when: ansible_python_version < 3

- name: Install python3-passlib (apt)
  become: true
  become_user: "{{ root_user }}"
  apt:
    name:
      - python3-passlib
  when: ansible_python_version >= 3

- include_role:
    name: release_notes
  vars:
    section: "MPI libraries"
    option: "openmpi"
    value: "Run using 'mpirun <NUMPROCS> <EXECNAME>'"
  when: release_notes is defined and release_notes
